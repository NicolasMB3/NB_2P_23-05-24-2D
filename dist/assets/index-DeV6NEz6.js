var v=l=>{throw TypeError(l)};var L=(l,e,t)=>e.has(l)||v("Cannot "+t);var y=(l,e,t)=>e.has(l)?v("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(l):e.set(l,t);var m=(l,e,t)=>(L(l,e,"access private method"),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=t(i);fetch(i.href,n)}})();var u,g;class b{constructor(e,t,s){y(this,u);this.MIN_WIDTH=500,this.MIN_HEIGHT=300,this.isFullScreen=!1,this.shiftX=null,this.zIndex=0,this.shiftY=null,this.activeWindow=null,this.isResizingWidth=!1,this.isResizingHeight=!1,this.animationFrameId=null,this.lastEvent=null,this.originalSize={width:"",height:"",top:"",left:""},this.icon=s,this.classWindows=e,this.windowElement=t}init(e){const t=e.querySelector(".controller");this.addMinimizeButtonListener(e),this.addExpandButtonListener(e),this.addCloseButtonListener(e),this.addControllerListeners(t,e),this.addWindowElementListeners(t,e),document.addEventListener("mouseup",()=>this.onMouseUp())}addMinimizeButtonListener(e){const t=e.querySelector(".minus");t.addEventListener("dblclick",s=>s.preventDefault()),t.addEventListener("click",()=>this.minimizeWindow(e,this.icon))}addExpandButtonListener(e){const t=e.querySelector(".expand");t.addEventListener("dblclick",s=>s.preventDefault()),t.addEventListener("click",()=>this.setFullScreen(e))}addCloseButtonListener(e){const t=e.querySelector(".close");t.addEventListener("dblclick",s=>s.preventDefault()),t.addEventListener("click",()=>this.closeWindow(e))}addControllerListeners(e,t){e.addEventListener("mousedown",s=>this.onMouseDown(e,t,s)),e.addEventListener("mouseup",()=>this.onMouseUp()),e.addEventListener("dblclick",()=>this.setFullScreen(t)),e.addEventListener("mouseleave",()=>this.onMouseLeave())}addWindowElementListeners(e,t){t.addEventListener("mousemove",s=>this.onMouseMoveCursor(s,t)),t.addEventListener("mousedown",s=>this.onWindowMouseDown(s,e,t))}bringToFront(e){e.style.zIndex=(++this.zIndex).toString()}closeWindow(){if(this.windowElement.querySelector("canvas.snake")){const t=this.windowElement.querySelector("canvas.snake").id,s=document.getElementById(t);s&&s.snakeGame&&s.snakeGame.stopGame()}this.windowElement.remove()}minimizeWindow(e,t){e.classList.add("minimized"),setTimeout(()=>{e.style.display="none"},500);const s=document.querySelector(".dock_content");let i=s.querySelector(`.active_dock[data-icon="${t}"]`);i||(i=document.createElement("div"),i.classList.add("active_dock"),i.dataset.icon=t,i.innerHTML=`<img class="window_dock_folder items_dock" src="${t}" alt="Image de fenêtre">`,s.appendChild(i));const n=JSON.parse(i.dataset.windows||"[]"),o=i.cloneNode(!0);n.push(e.id),i.dataset.windows=JSON.stringify(n),i.parentNode.replaceChild(o,i),i=o,n.length===1?i.addEventListener("click",()=>{this.restoreWindow(e,i)}):i.addEventListener("click",()=>{const a=i.querySelector(".window-menu");a?a.remove():this.showWindowMenu(i)})}showWindowMenu(e){const t=JSON.parse(e.dataset.windows||"[]"),s=document.createElement("div");s.className="window-menu",s.innerHTML="",t.forEach(i=>{const n=document.createElement("div");n.textContent=i,n.addEventListener("click",()=>{this.restoreWindow(document.getElementById(i),e);const o=e.querySelector(".window-menu");o&&o.remove()}),s.appendChild(n)}),e.appendChild(s)}restoreWindow(e,t){e.classList.remove("minimized"),e.style.display="block";const s=JSON.parse(t.dataset.windows||"[]");if(t.dataset.windows=JSON.stringify(s.filter(i=>i!==e.id)),s.length<=1)t.remove();else{const i=t.querySelector(".window-menu");i&&i.remove()}}setFullScreen(e){const t=document.querySelector(".navigation").offsetHeight;this.isFullScreen?(e.style.width=this.originalSize.width,e.style.height=this.originalSize.height,e.style.top=this.originalSize.top,e.style.left=this.originalSize.left,e.classList.add("fullScreen"),this.isFullScreen=!1):(this.originalSize={width:e.style.width,height:e.style.height,top:e.style.top,left:e.style.left},this.bringToFront(e),e.style.top=t+"px",e.style.left="0px",e.style.width=window.innerWidth+"px",e.style.height=e.parentElement.clientHeight+"px",e.classList.add("fullScreen"),this.isFullScreen=!0),requestAnimationFrame(()=>{const s=e.querySelector("#snake");if(s){s.width=e.offsetWidth,s.height=e.offsetHeight-e.querySelector(".controller").offsetHeight;const i=s.snakeGame;i&&!i.gameOver&&(i.apple.left=Math.min(i.apple.left,s.width-10),i.apple.top=Math.min(i.apple.top,s.height-10),i.snake=i.snake.map(n=>({left:Math.min(n.left,s.width-10),top:Math.min(n.top,s.height-10)})))}}),e.classList.remove("fullScreen"),e.addEventListener("transitionend",()=>{e.classList.remove("fullScreen")})}resizeWidth(e){const s=this.activeWindow.parentElement.getBoundingClientRect(),i=this.activeWindow.getBoundingClientRect(),n=e.pageX-i.left,o=s.width-i.left;this.activeWindow.style.width=Math.min(Math.max(n,this.MIN_WIDTH),o)+"px",this.classWindows.bringToFront(this);const a=this.activeWindow.querySelector("#snake");a&&(a.width=n)}resizeHeight(e){const s=this.activeWindow.parentElement.getBoundingClientRect(),i=this.activeWindow.getBoundingClientRect(),n=e.pageY-i.top,o=s.height-i.top;this.activeWindow.style.height=Math.min(Math.max(n,this.MIN_HEIGHT),o)+"px",this.classWindows.bringToFront(this);const a=this.activeWindow.querySelector("#snake");a&&(a.height=n)}move(){if(this.activeWindow&&!this.isResizingWidth&&!this.isResizingHeight&&this.lastEvent){const t=this.activeWindow.parentElement.getBoundingClientRect(),s=document.querySelector(".navigation").offsetHeight,i=this.lastEvent.pageX-this.shiftX,n=this.lastEvent.pageY-this.shiftY,o=i+this.activeWindow.offsetWidth,a=n+this.activeWindow.offsetHeight;i>=0&&o<=t.width?this.activeWindow.style.left=i+"px":i<0?this.activeWindow.style.left="0px":o>t.width&&(this.activeWindow.style.left=t.width-this.activeWindow.offsetWidth+"px"),n>=s&&a<=t.height+s?this.activeWindow.style.top=n+"px":n<s?this.activeWindow.style.top=s+"px":a>t.height+s&&(this.activeWindow.style.top=t.height+s-this.activeWindow.offsetHeight+"px")}}onMouseUp(){this.activeWindow=null,this.isResizingWidth=!1,this.isResizingHeight=!1,this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)}onMouseMove(e){this.lastEvent=e,this.activeWindow&&!this.isResizingWidth&&!this.isResizingHeight&&(this.animationFrameId&&cancelAnimationFrame(this.animationFrameId),this.animationFrameId=requestAnimationFrame(()=>this.move()))}onResizeMove(e){this.isResizingWidth?this.resizeWidth(e):this.isResizingHeight&&this.resizeHeight(e)}handleMouseDown(e,t,s){const{mouseX:i,mouseY:n,windowWidth:o,windowHeight:a}=m(this,u,g).call(this,e,s);this.shiftX=i,this.shiftY=n,i>o*.98?(this.isResizingWidth=!0,this.isResizingHeight=!1):n>a*.98?(this.isResizingWidth=!1,this.isResizingHeight=!0):e.target===t&&(s.style.position="absolute",this.bringToFront(s),document.addEventListener("mousemove",r=>this.onMouseMove(r))),this.activeWindow=s,document.addEventListener("mousemove",r=>this.onResizeMove(r))}onMouseDown(e,t,s){this.handleMouseDown(s,e,t),this.classWindows.bringToFront(this)}onWindowMouseDown(e,t,s){if(e.target.classList.contains("content"))return;const{mouseX:i,mouseY:n,windowWidth:o,windowHeight:a}=m(this,u,g).call(this,e,s),r=10;i>o-r&&n>a-r?(this.isResizingWidth=!0,this.isResizingHeight=!0):i>o-r?(this.isResizingWidth=!0,this.isResizingHeight=!1):n>a-r?(this.isResizingWidth=!1,this.isResizingHeight=!0):e.target===t&&this.handleMouseDown(e,t,s),this.activeWindow=s,document.addEventListener("mousemove",c=>this.onResizeMove(c))}onMouseMoveCursor(e,t){const{mouseX:s,mouseY:i,windowWidth:n,windowHeight:o}=m(this,u,g).call(this,e,t),a=10;s>n-a&&i>o-a?document.body.style.cursor="nwse-resize":s>n-a?document.body.style.cursor="ew-resize":i>o-a?document.body.style.cursor="ns-resize":document.body.style.cursor="default"}onMouseLeave(){document.body.style.cursor="default"}}u=new WeakSet,g=function(e,t){const s=t.getBoundingClientRect(),i=e.clientX-s.left,n=e.clientY-s.top,o=s.width,a=s.height;return{mouseX:i,mouseY:n,windowWidth:o,windowHeight:a}};class E{constructor(){this.dateElement=document.querySelector(".navigation .date-time"),this.notificationCenter=document.querySelector(".notification-center")}init(){this.updateDateTime(),setInterval(()=>this.updateDateTime(),3e4),this.dateElement.addEventListener("click",this.showNotificationCenter.bind(this))}showNotificationCenter(){this.notificationCenter.style.display="block"}updateDateTime(){const e=new Date,t={day:"numeric",month:"long",hour:"2-digit",minute:"2-digit"},s=document.querySelector(".navigation .date-time");let i=e.toLocaleDateString("fr-FR",t);i=i.replace("à"," "),s.textContent=i}}const M={ArrowUp:"↑",ArrowDown:"↓",ArrowLeft:"←",ArrowRight:"→"},T=l=>`
        <div id="param1_content" class="${l}">
            <h2>Paramètres</h2>
            <div>
                <label for="theme">Fond d'écran</label>
                <select name="theme" id="theme">
                    <option value="pattern">Pattern 0</option>
                    <option value="pattern-1">Pattern 1</option>
                </select>
            </div>
            <div class="controller-settings">
                <p>Placement des boutons de contrôle des fenêtres</p>
                <label for="control-left">Gauche</label>
                <input type="radio" name="control" value="left" id="control-left" ${localStorage.getItem("controllerPlacement")==="left"?"checked":""}>
                <label for="control-right">Droite</label>
                <input type="radio" name="control" value="right" id="control-right" ${localStorage.getItem("controllerPlacement")==="right"?"checked":""}>
            </div>
        </div>
    `,D=l=>`
        <div id="param1_content" class="${l}">
            <p>Paramètres 2</p>
        </div>
    `,P=l=>{const e=JSON.parse(localStorage.getItem("keys"))||{up:"ArrowUp",down:"ArrowDown",left:"ArrowLeft",right:"ArrowRight"},t=localStorage.getItem("snakeColor")||"#38B35E",s={ArrowUp:"↑",ArrowDown:"↓",ArrowLeft:"←",ArrowRight:"→"},i=s[e.up]||e.up,n=s[e.down]||e.down,o=s[e.left]||e.left,a=s[e.right]||e.right,r=localStorage.getItem("pauseKey")||"p",c=s[r]||r;return`
        <div id="param7_content" class="${l}">
            <h2>Paramètres du jeu Snake 🐍</h2>
            <p class="controller-text">Personnalisez les <span class="bold">touches</span> du serpent.</p>
            <div class="map-container">
                <div class="key-label"></div>
                <div class="key-input toucheH" id="up-key" tabindex="0">${i}</div>
                <div class="key-label"></div>
                <div class="key-input toucheG" id="left-key" tabindex="0">${o}</div>
                <div class="key-input toucheB" id="down-key" tabindex="0">${n}</div>
                <div class="key-input toucheD" id="right-key" tabindex="0">${a}</div>
            </div>
            <div class="pause-container">
                <span class="pause-label">Personnalisez la touche <span class="bold">Pause</span>.</span>
                <div class="key-input toucheP" id="pause-key" tabindex="0">${c}</div>
            </div>
            <div class="color-container">
                <label for="snake-color">Personnalisez la <span class="bold">couleur</span> du serpent.</label>
                <input type="color" id="snake-color" name="snake-color" value="${t}">
            </div>
        </div>
    `},H={param1:T("test"),param2:D("test 2"),param4:P("test 2")};class w{constructor(){this.windows=[],this.highestZIndex=0,this.contentParams=H,localStorage.setItem("controllerPlacement","right"),this.classNavigation=new E,this.init()}init(){this.classNavigation.init()}addWindow(e){this.windows.push(e)}createWindowElement(e,t,s,i){return`
            <div class="window position-${e} ${s==="Snake"?"snake-window":""}" data-name="${s}" style="--random-color: ${this.getRandomColor()}">
                <div class="controller block_highlights ${localStorage.getItem("controllerPlacement")==="left"?"row-reverse":""}">
                    <p>${s}</p>
                    <div class="icon_controller">
                        <span class="minus"></span>
                        <span class="expand"></span>
                        <span class="close"></span>
                    </div>
                </div>
                <div class="content">
                    ${i}
                </div>
            </div>
        `}getRandomColor(){let e=Math.floor(Math.random()*16777215).toString(16);for(;e.length<6;)e="0"+e;return"#"+e}createNewWindow(e,t,s,i){const n=typeof i=="function"?i():i,o=this.createWindowElement(e,t,s,n);document.querySelector(".windows_area").insertAdjacentHTML("beforeend",o);const a=document.querySelector(".windows_area").lastElementChild,r=new b(this,a,t);return this.addWindow(r),a.id=`window-${Date.now()}`,r.init(a),a.addEventListener("click",()=>{this.bringToFront(r)}),this.bringToFront(r),this.addNavigationClickHandler(a),a}addNavigationClickHandler(e){const t=e.querySelector(".param_nav"),s=e.querySelector(".param_content");let i=null;t&&t.addEventListener("click",n=>{n.target.tagName==="LI"&&this.handleNavigationClick(n,s,e,i)})}handleNavigationClick(e,t,s,i){const n=e.target.getAttribute("id");t.innerHTML=this.contentParams[n]||"",this.addBackgroundChangeHandler(s);const o=s.querySelector("#control-left"),a=s.querySelector("#control-right");o&&a&&(o.addEventListener("change",()=>this.changeControllerPlacement("left")),a.addEventListener("change",()=>this.changeControllerPlacement("right")));const r=s.querySelector("#snake-color");r&&this.addSnakeColorChangeHandler(r),s.querySelectorAll(".key-input").forEach(d=>{this.addKeyInputHandlers(d,i,s)})}addSnakeColorChangeHandler(e){e.addEventListener("change",t=>{this.changeSnakeColor(t.target.value)})}addKeyInputHandlers(e,t,s){e.addEventListener("click",()=>{t&&t.classList.remove("active"),e.classList.add("active"),t=e}),e.addEventListener("keydown",i=>{this.handleKeydownOnInput(i,e,s)})}handleKeydownOnInput(e,t,s){e.preventDefault();const i=e.key;t.textContent=M[i]||i,t.classList.contains("toucheP")&&this.changeSnakePause(t.textContent);const n={up:s.querySelector("#up-key").textContent==="↑"?"ArrowUp":s.querySelector("#up-key").textContent,down:s.querySelector("#down-key").textContent==="↓"?"ArrowDown":s.querySelector("#down-key").textContent,left:s.querySelector("#left-key").textContent==="←"?"ArrowLeft":s.querySelector("#left-key").textContent,right:s.querySelector("#right-key").textContent==="→"?"ArrowRight":s.querySelector("#right-key").textContent};this.changeKeySnake(n)}changeControllerPlacement(e){document.querySelectorAll(".controller").forEach(s=>{e==="left"?(s.style.flexDirection="row-reverse",s.querySelector(".icon_controller").style.flexDirection="row-reverse"):(s.style.flexDirection="row",s.querySelector(".icon_controller").style.flexDirection="row")}),localStorage.setItem("controllerPlacement",e)}changeSnakeColor(e){localStorage.setItem("snakeColor",e)}changeSnakePause(e){localStorage.setItem("pauseKey",e)}changeBackground(e){document.body.style.backgroundImage=`url('/${e}.svg')`}changeKeySnake(e){localStorage.setItem("keys",JSON.stringify(e))}addBackgroundChangeHandler(e){const t=e.querySelector("#theme");t&&t.addEventListener("change",s=>{this.changeBackground(s.target.value)})}bringToFront(e){e.zIndex=++this.highestZIndex,e.windowElement.style.zIndex=this.highestZIndex}createPopup(e,t,s){const i=document.createElement("div");i.classList.add("blur-background");const n=document.createElement("div");n.classList.add("popup");const o=document.createElement("p");if(o.textContent=e,n.appendChild(o),t){const a=document.createElement("button");a.textContent=t,n.appendChild(a)}if(s){const a=document.createElement("button");a.textContent=s,n.appendChild(a)}i.appendChild(n),document.body.appendChild(i)}}const S=`
     <div class="param_nav">
        <ul>
            <li id="param1">Apparence</li>
            <li id="param2">Dock Proto</li>
            <li id="param3">Notifications</li>
            <li id="param4">Snake</li>
            <li id="param5">Système</li>
            <li id="param6">À Propos</li>
        </ul>
     </div>
    <div class="param_content"></div>
`;class I{constructor(){this.notifications=[],this.notificationContainer=document.querySelector(".notification-center"),this.timeOutNotification=6e4}addNotification(e){this.notifications.push(e),this.notificationContainer.appendChild(e)}createNotificationElement(e,t){const s=document.createElement("div"),i=document.createElement("h2"),n=document.createElement("div"),o=document.createElement("div");return i.textContent=e,n.textContent=t,o.appendChild(i),o.appendChild(n),o.classList.add("notification-content"),s.className="notification",s.appendChild(o),s}addNotificationButton(e,t,s){t.addEventListener("click",()=>{s&&s(),this.notificationContainer.removeChild(e)}),e.appendChild(t)}setNotificationColor(e,t){t&&e.style.setProperty("--notification-color",t)}displayNotification(e,t,s=null,i=null,n=null){const o=this.createNotificationElement(e,t);s&&this.addNotificationButton(o,s,i),this.setNotificationColor(o,n),this.addNotification(o),this.removeTimeoutNotification(o)}removeTimeoutNotification(e){setTimeout(()=>{const t=this.notifications.indexOf(e);if(t>-1){this.notifications.splice(t,1);const s=e.querySelector(".replay-button");s&&s.remove(),e.remove()}},this.timeOutNotification)}}class q{constructor(e,t){this.canvasId=e,this.windows=t,this.canvas=null,this.context=null,this.snake=[{top:200,left:200}],this.direction="right",this.apple=null,this.gameOver=!1,this.walls=[],this.board=[],this.lastKey=null,this.baseScore=0,this.directionQueue=[],this.speed=100,this.fastSpeed=40,this.fastModeStartTime=null,this.currentSpeed=this.speed,this.speedTimeout=null,this.lastWallScore=0,this.goldenApple=null,this.goldenAppleTimeout=null,this.lastTime=Date.now(),this.isPaused=!1,this.lastTailPosition=null,this.gameLoop=this.gameLoop.bind(this),this.snakeColor="#0e881f",this.keyIsDown=!1,this.stamina=100}init(){this.directionQueue=[],this.setupCanvas(),this.createMainMenu(),this.setupEventHandlers()}createMainMenu(){this.mainMenu=document.createElement("div"),this.mainMenu.classList.add("main-menu"),this.mainMenu.style.position="absolute",this.mainMenu.style.top=document.querySelector(".controller").offsetHeight+"px",this.mainMenu.style.left="0",this.mainMenu.style.width="100%",this.mainMenu.style.height=`calc(100% - ${document.querySelector(".controller").offsetHeight+"px"})`;const e=document.createElement("h3");e.textContent="Snake 0.1";const t=document.createElement("button");t.textContent="Nouvelle partie";const s=document.createElement("button");s.textContent="Options",t.addEventListener("click",()=>{this.mainMenu.style.display="none",this.setupGame(),this.gameLoop()}),s.addEventListener("click",()=>{const i=this.windows.createNewWindow("center","./images/parameters.png","Paramètres",S);setTimeout(()=>{const n=i.querySelector("#param4");n&&n.click()},0)}),this.mainMenu.appendChild(e),this.mainMenu.appendChild(t),this.mainMenu.appendChild(s),this.canvas.parentElement.appendChild(this.mainMenu)}setupCanvas(){this.canvas=document.getElementById(this.canvasId),this.context=this.canvas.getContext("2d"),this.board=Array(this.canvas.width/10).fill(void 0,void 0,void 0).map(()=>Array(this.canvas.height/10).fill(0)),this.createPauseOverlay(),this.snakeColor=localStorage.getItem("snakeColor")||"#0e881f",this.canvas.parentElement.appendChild(this.pauseOverlay)}setupGame(){this.draw(),this.update(),this.snake=[{top:200,left:200}],this.walls=[],this.apple=null,this.direction="right",this.gameOver=!1}setupEventHandlers(){let e=localStorage.getItem("keys");e=e?JSON.parse(e):{up:"ArrowUp",down:"ArrowDown",left:"ArrowLeft",right:"ArrowRight"},this.keydownHandler&&window.removeEventListener("keydown",this.keydownHandler),this.keydownHandler=this.createKeydownHandler(e),window.addEventListener("keydown",this.keydownHandler),this.keyupHandler&&window.removeEventListener("keyup",this.keyupHandler),this.keyupHandler=this.createKeyupHandler(e),window.addEventListener("keyup",this.keyupHandler),this.keydownPauseHandler&&window.removeEventListener("keydown",this.keydownPauseHandler),this.keydownPauseHandler=t=>this.handleKeyDown(t),window.addEventListener("keydown",this.keydownPauseHandler)}createKeydownHandler(e){return t=>{const s=Object.keys(e).find(i=>e[i].toLowerCase()===t.key.toLowerCase());s&&(!this.lastKey||this.lastKey!==s)&&(this.directionQueue.push(s),this.lastKey=s),!this.speedTimeout&&!this.keyIsDown&&this.direction===s&&(this.keyIsDown=!0,this.fastModeStartTime=Date.now(),this.speedTimeout=setTimeout(()=>{this.currentSpeed=this.fastSpeed,this.speedTimeout=null},100),this.stamina-=1,this.stamina===0&&(this.snake.length=Math.max(1,this.snake.length-1)))}}createKeyupHandler(e){return t=>{this.keyIsDown=!1,this.changeDirection(t.key,e),this.speedTimeout&&(clearTimeout(this.speedTimeout),this.speedTimeout=null),this.fastModeStartTime&&(Date.now()-this.fastModeStartTime>700&&this.stamina===0&&(this.snake.length=Math.max(1,this.snake.length-1)),this.fastModeStartTime=null),this.currentSpeed=this.speed,this.lastKey=null,this.staminaRefillInterval&&clearInterval(this.staminaRefillInterval),this.staminaRefillInterval=setInterval(()=>{this.stamina<100?this.stamina++:clearInterval(this.staminaRefillInterval)},75)}}createPauseOverlay(){this.pauseOverlay=document.createElement("div"),this.pauseOverlay.style.position="absolute",this.pauseOverlay.style.top="40px",this.pauseOverlay.style.left="0",this.pauseOverlay.style.width="100%",this.pauseOverlay.style.height="calc(100% - 40px)",this.pauseOverlay.style.display="none",this.pauseOverlay.style.borderRadius="0 0 10px 10px",this.pauseOverlay.style.justifyContent="center",this.pauseOverlay.style.alignItems="center",this.pauseOverlay.style.backgroundColor="rgba(255, 255, 255, 0.2)",this.pauseOverlay.style.backdropFilter="blur(8px)",this.pauseOverlay.innerHTML='<img class="pause" src="./pause.svg" alt="Pause">'}drawScore(){this.context.fillStyle="black",this.context.font="16px Arial";const e=this.snake.length-1;this.context.fillText("Score: "+e,10,30);const t=localStorage.getItem("bestScore")||0;this.context.fillText("Meilleur score: "+t,120,30)}updateBestScore(){const e=this.snake.length-1,t=localStorage.getItem("bestScore")||0;e>t&&localStorage.setItem("bestScore",e.toString())}gameLoop(){if(this.isPaused){requestAnimationFrame(e=>this.gameLoop(e));return}if(!this.gameOver){const e=Date.now(),t=e-this.lastTime;t>this.currentSpeed&&(this.lastTime=e-t%this.currentSpeed,this.update()),this.keyIsDown?(this.stamina=Math.max(this.stamina-1,0),this.stamina===0?this.scoreInterval||(this.scoreInterval=setInterval(()=>{this.baseScore=Math.max(0,this.baseScore-1),this.snake.length=Math.max(1,this.snake.length-1)},1e3)):this.scoreInterval&&(clearInterval(this.scoreInterval),this.scoreInterval=null)):this.scoreInterval&&(clearInterval(this.scoreInterval),this.scoreInterval=null),this.draw()}requestAnimationFrame(e=>this.gameLoop(e))}draw(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.drawStaminaBar(),this.snakeColor=localStorage.getItem("snakeColor")||"#0e881f",this.context.fillStyle=this.snakeColor,this.lastTailPosition&&this.context.clearRect(this.lastTailPosition.left,this.lastTailPosition.top,10,10),this.snake.forEach((e,t)=>{this.context.fillRect(e.left,e.top,10,10),t===0&&(this.context.fillStyle="white",this.direction==="right"||this.direction==="left"?(this.context.fillRect(e.left+2,e.top+2,2,2),this.context.fillRect(e.left+6,e.top+2,2,2)):(this.context.fillRect(e.left+2,e.top+2,2,2),this.context.fillRect(e.left+2,e.top+6,2,2)),this.context.fillStyle=this.snakeColor)}),this.apple&&(this.context.beginPath(),this.context.arc(this.apple.left+5,this.apple.top+5,5,0,Math.PI*2,!0),this.context.closePath(),this.context.fillStyle="red",this.context.fill(),this.context.fillStyle="green",this.context.fillRect(this.apple.left+2,this.apple.top-2,3,2),this.context.fillRect(this.apple.left+5,this.apple.top-2,3,2)),this.goldenApple&&(this.context.beginPath(),this.context.arc(this.goldenApple.left+5,this.goldenApple.top+5,5,0,Math.PI*2,!0),this.context.closePath(),this.context.fillStyle="gold",this.context.fill(),this.context.fillStyle="green",this.context.fillRect(this.goldenApple.left+2,this.goldenApple.top-2,3,2),this.context.fillRect(this.goldenApple.left+5,this.goldenApple.top-2,3,2)),this.drawScore(),this.context.fillStyle="black",this.walls.forEach(e=>{this.context.fillRect(e.left,e.top,10,10)})}drawStaminaBar(){this.context.fillStyle="black",this.context.fillRect(10,50,100,10),this.context.fillStyle="#1a33b8",this.context.fillRect(10,50,this.stamina,10)}checkSelfCollision(){const e=this.snake[0];return this.board[e.left/10][e.top/10]===1}update(){this.directionQueue.length>0&&(this.direction=this.directionQueue.shift());const e=this.calculateNewHeadPosition();if(this.isOutOfBounds(e)){this.handleGameOver();return}this.updateBoard(),this.snake.unshift(e),this.updateOccupiedPositions(),this.apple&&this.isAppleEaten(e)?(this.apple=null,this.baseScore++):(this.updateTailPosition(),this.snake.pop()),this.goldenApple&&this.isGoldenAppleEaten(e)&&(this.extendSnake(),this.removeGoldenApple()),(this.checkSelfCollision()||this.checkWallCollision())&&this.handleGameOver(),this.apple||this.generateApple(),this.generateWalls(),this.updateBestScore()}calculateNewHeadPosition(){const e=Object.assign({},this.snake[0]);switch(this.direction){case"left":e.left-=10;break;case"up":e.top-=10;break;case"right":e.left+=10;break;case"down":e.top+=10;break}return e}isOutOfBounds(e){return e.left<0||e.left>=this.canvas.width||e.top<0||e.top>=this.canvas.height}updateBoard(){this.board=this.board.map((e,t)=>e.map((s,i)=>this.snake.some(n=>n.left===t*10&&n.top===i*10)?1:this.apple&&this.apple.left===t*10&&this.apple.top===i*10?2:this.goldenApple&&this.goldenApple.left===t*10&&this.goldenApple.top===i*10?3:this.walls.some(n=>n.left===t*10&&n.top===i*10)?4:0))}updateOccupiedPositions(){this.occupiedPositions=new Set(this.snake.map(e=>`${e.left},${e.top}`)),this.walls.forEach(e=>this.occupiedPositions.add(`${e.left},${e.top}`))}isAppleEaten(e){return this.apple.top===e.top&&this.apple.left===e.left}updateTailPosition(){this.lastTailPosition={...this.snake[this.snake.length-1]}}isGoldenAppleEaten(e){return this.goldenApple.top===e.top&&this.goldenApple.left===e.left}extendSnake(){for(let e=0;e<5;e++){const t=this.snake[this.snake.length-1];this.snake.push({top:t.top,left:t.left})}}removeGoldenApple(){clearTimeout(this.goldenAppleTimeout),this.goldenApple=null,this.goldenAppleTimeout=null}changeDirection(e,t){const s=e.toLowerCase(),i={up:t.up.toLowerCase(),down:t.down.toLowerCase(),left:t.left.toLowerCase(),right:t.right.toLowerCase()};switch(s){case i.up:this.direction="up";break;case i.down:this.direction="down";break;case i.left:this.direction="left";break;case i.right:this.direction="right";break}}checkWallCollision(){const e=this.snake[0];return this.board[e.left/10][e.top/10]===4}stopGame(){this.gameOver=!0}generateWalls(){if(this.baseScore>=10&&this.baseScore-this.lastWallScore>=10){const e=Math.pow(this.baseScore,1);for(let t=0;t<e;t++){let s;do s={top:Math.floor(Math.random()*this.canvas.height/10)*10,left:Math.floor(Math.random()*this.canvas.width/10)*10};while(this.isTooCloseToSnake(s,30));this.walls.push(s)}this.lastWallScore=this.baseScore}}isTooCloseToSnake(e,t){const s=this.snake[0];return Math.sqrt(Math.pow(e.left-s.left,2)+Math.pow(e.top-s.top,2))<t}generateApple(){const e=this.getFreePositions(),t=Math.floor(Math.random()*e.length);if(this.apple=e[t],Math.random()<.1){const s=Math.floor(Math.random()*e.length);this.goldenApple=e[s],this.goldenAppleTimeout=setTimeout(()=>this.removeGoldenApple(),6e3)}this.board[this.apple.left/10][this.apple.top/10]=2}getFreePositions(){const e=[];for(let t=0;t<this.board.length;t++)for(let s=0;s<this.board[0].length;s++)this.board[t][s]===0&&e.push({left:t*10,top:s*10});return e}handleGameOver(){if(!this.gameOver){this.gameOver=!0;const e=new I,t=document.createElement("button"),s=this.canvas.closest(".window"),n=getComputedStyle(s).getPropertyValue("--random-color");let o=this.canvas.parentElement.querySelector(".replay-button");t.textContent="Rejouer",o||e.displayNotification("Game Over","Score: "+(this.snake.length-1),t,null,n),t.onclick=null,t.addEventListener("click",()=>this.restartGame()),this.updateBestScore()}}handleKeyDown(e){const t=localStorage.getItem("pauseKey")||"p";e.key.toLowerCase()===t.toLowerCase()&&(this.isPaused=!this.isPaused,this.isPaused?this.pauseOverlay.style.display="flex":(this.pauseOverlay.style.display="none",this.gameLoop()))}restartGame(){const e=this.canvas.width,t=this.canvas.height,s=document.createElement("canvas");s.id=this.canvasId,s.classList.add("snake"),s.width=e,s.height=t,this.canvas.replaceWith(s),this.canvas=s,this.pauseOverlay.remove(),this.init()}}class k{constructor(e,t){this.canvasId=e,this.windows=t,this.emulator=null,this.addCloseButtonHandler()}addCloseButtonHandler(){if(!this.canvasId)return;const e=document.querySelector(".close");if(!e){console.error("Element with class 'close' not found.");return}e.addEventListener("click",this.stop.bind(this))}launch(){const e=document.getElementById(this.canvasId);if(!e){console.error(`Element with id '${this.canvasId}' not found.`);return}emulators.pathPrefix="./JS-DOS/",this.emulator=Dos(e,{wdosboxUrl:"./JS-DOS/wdosbox.js"}),this.removeFlexGrowElements(e),this.emulator.run("./doom.jsdos").then(()=>{console.log("Emulator is running.")}).catch(t=>{console.error("Error running emulator:",t)})}removeFlexGrowElements(e){const t=e.getElementsByClassName("flex-grow-0");for(;t.length>0;)t[0].remove()}stop(){this.emulator?(this.emulator.stop(),console.log("Emulator stopped.")):console.error("No emulator instance to stop.")}}class A{constructor(e){this.desktop=e,this.trash=[]}onTrashDrop(e){e.preventDefault();const t=e.dataTransfer.getData("text/plain"),s=document.querySelector(`.desktop-folder[data-name="${t}"]`);s&&s.dataset.name!=="Poubelle"&&this.removeFolderAndWindow(s)}moveSelectedFoldersToTrash(){this.desktop.selectedFolders.forEach(e=>{if(e.dataset.name!=="Poubelle"){this.trash.push(e),e.remove();const[t,s]=this.desktop.getFolderPosition(e);this.desktop.grid[t][s]=0;const i=document.querySelector(`.window[data-name="${e.dataset.name}"]`);i&&i.remove()}}),this.desktop.selectedFolders=[]}addRestoreEvent(e){const t=s=>{const i=this.desktop.createContextMenu(s,e);i.querySelector(".restore").addEventListener("click",()=>{this.trash=this.trash.filter(o=>o.dataset.name!==e.dataset.name),this.desktop.setFolderPosition(e),e.setAttribute("draggable","true"),document.querySelector(".windows_area").appendChild(e),i.remove(),this.updateTrashWindowContent(),e.removeEventListener("contextmenu",t),this.moveToTrash(e);const n=this.desktop.content[e.dataset.name];this.desktop.addDoubleClickEvent(e,e.dataset.name,n,"icon_du_dossier"),e.closest(".window")&&e.closest(".window").removeChild(e),this.desktop.addDragEvents(e,e.dataset.name)}),document.body.appendChild(i)};e.addEventListener("contextmenu",t)}removeFolderAndWindow(e){this.trash.push(e),e.remove();const t=new CustomEvent("trashUpdated");document.dispatchEvent(t);const[s,i]=this.desktop.getFolderPosition(e);this.desktop.grid[s][i]=0;const n=document.querySelector(`.window[data-name="${e.dataset.name}"]`);n&&n.remove()}moveToTrash(e){e.dataset.name!=="Poubelle"&&e.addEventListener("contextmenu",t=>{const s=this.desktop.createContextMenu(t,e);s.querySelector(".delete").addEventListener("click",()=>{this.removeFolderAndWindow(e),s.remove()}),document.body.appendChild(s)})}emptyBin(){this.trash=[],this.updateTrashWindowContent()}updateTrashWindowContent(){const e=document.querySelectorAll('.window[data-name="Poubelle"]');e&&e.forEach(t=>{t.querySelector(".content").innerHTML=this.trash.map(s=>this.desktop.createFolderElement(s.dataset.name,s.querySelector("img").src).outerHTML).join(""),this.trash.forEach((s,i)=>{const n=t.querySelector(`.desktop-folder:nth-child(${i+1})`);this.addRestoreEvent(n)})})}}class F{constructor(e,t){this.canvasId=e,this.windows=t,this.emulator=null,this.addCloseButtonHandler()}addCloseButtonHandler(){if(!this.canvasId)return;const e=document.querySelector(".close");if(!e){console.error("Element with class 'close' not found.");return}e.addEventListener("click",this.stop.bind(this))}launch(){const e=document.getElementById(this.canvasId);if(!e){console.error(`Element with id '${this.canvasId}' not found.`);return}emulators.pathPrefix="./JS-DOS/",this.emulator=Dos(e,{wdosboxUrl:"./JS-DOS/wdosbox.js"}),this.removeFlexGrowElements(e),this.emulator.run("./pacman.jsdos").then(()=>{console.log("Emulator is running.")}).catch(t=>{console.error("Error running emulator:",t)})}removeFlexGrowElements(e){const t=e.getElementsByClassName("flex-grow-0");for(;t.length>0;)t[0].remove()}stop(){this.emulator?(this.emulator.stop(),console.log("Emulator stopped.")):console.error("No emulator instance to stop.")}}class x{constructor(e){this.windows=e,this.selectedFolders=[],this.originalPositions={},this.content={},this.isSelecting=!1,this.selectionBox=null,this.gridSize=135,this.gap=10,this.startX=0,this.startY=0,this.iconSize=50,this.draggedFolderName=null,this.windowsArea=document.querySelector(".windows_area"),this.navigation=document.querySelector(".navigation"),this.grid=this.createGrid(),this.hierarchy=new A(this),this.snakeGameCounter=0,this.doomGameCounter=0,this.pacmanGameCounter=0,this.setLocalStorageKeys(),this.init()}init(){this.windowsArea.addEventListener("mousedown",e=>{this.removeSelection(e),this.startSelection(e)}),this.windowsArea.addEventListener("mousemove",e=>this.updateSelection(e)),this.windowsArea.addEventListener("mouseup",e=>this.endSelection(e)),document.addEventListener("keydown",e=>this.handleKeyDown(e)),this.launchSnakeOnWindowOpen(),this.setupDragAndDrop()}createLN(e,t,s,i){const n=this.createFolderElement(e,s,i);this.setFolderPosition(n),this.addDragEvents(n,e),this.content[e]=t,e==="Poubelle"?(this.addDoubleClickEventTrash(n,e,t,s),this.addContextMenuEvent(n),n.addEventListener("drop",o=>this.hierarchy.onTrashDrop(o)),document.addEventListener("trashUpdated",()=>{this.hierarchy.updateTrashWindowContent()})):this.addDoubleClickEvent(n,e,t,s),document.querySelector(".windows_area").appendChild(n),this.hierarchy.moveToTrash(n)}createFolderElement(e,t,s){const i=document.createElement("div"),n=document.createElement("img"),o=document.createElement("div");return i.classList.add("desktop-folder","block_highlights"),i.dataset.name=e,i.dataset.type=s,i.childrenFolders={},n.src=t,n.alt=e,n.style.width=`${this.iconSize}px`,n.style.height=`${this.iconSize}px`,i.appendChild(n),o.textContent=e,i.appendChild(o),i}addDoubleClickEvent(e,t,s,i){e.addEventListener("dblclick",()=>{if(e.childrenFolders=e.childrenFolders||{},e.dataset.type==="folder"||e.dataset.type==="game"){const n=Object.values(e.childrenFolders);if(n.length>0){let o="";n.forEach(r=>{const c=this.createFolderElement(r.dataset.name,r.querySelector("img").src,r.dataset.type);o+=c.outerHTML});const a=this.windows.createNewWindow("center",i,t,o);n.forEach((r,c)=>{const d=a.querySelector(`.desktop-folder:nth-child(${c+1})`);this.addDoubleClickEvent(d,d.dataset.name,this.content[d.dataset.name],"icon_du_dossier")})}else{let o;typeof s=="function"?o=s():o=s,this.windows.createNewWindow("center",i,t,o)}}else{let n;typeof s=="function"?n=s():n=s,this.windows.createNewWindow("center",i,t,n)}})}addDoubleClickEventTrash(e,t,s,i){e.addEventListener("dblclick",()=>{const n=this.hierarchy.trash.map(a=>this.createFolderElement(a.dataset.name,a.querySelector("img").src).outerHTML).join(""),o=this.windows.createNewWindow("center",i,t,n);this.hierarchy.trash.forEach((a,r)=>{const c=o.querySelector(`.desktop-folder:nth-child(${r+1})`);this.hierarchy.addRestoreEvent(c)})})}setLocalStorageKeys(){const e={up:"ArrowUp",down:"ArrowDown",left:"ArrowLeft",right:"ArrowRight"};localStorage.setItem("keys",JSON.stringify(e)),localStorage.setItem("pauseKey","p")}createGrid(){const e=this.windowsArea.getBoundingClientRect(),t=this.navigation.offsetHeight,s=document.querySelector(".dock").offsetHeight,i=window.innerHeight-s-t,n=Math.floor(e.width/(this.gridSize+this.gap)),o=Math.floor(i/(this.gridSize+this.gap));return Array(n).fill(void 0).map(()=>Array(o).fill(0))}handleKeyDown(e){e.key==="Delete"&&this.hierarchy.moveSelectedFoldersToTrash()}addContextMenuEvent(e){e.addEventListener("contextmenu",t=>{this.createContextMenu(t,e)})}updateGrid(e){const t=e.dataset.name,s=this.getFolderPosition(e);if(s){const[r,c]=s;this.grid[r][c]=0}const i=e.getBoundingClientRect(),n=document.querySelector(".navigation").offsetHeight,o=Math.floor(i.left/(this.gridSize+this.gap)),a=Math.floor((i.top-n)/(this.gridSize+this.gap));o>=0&&o<this.grid.length&&a>=0&&a<this.grid[o].length&&(this.grid[o][a]=t)}launchDoom(){const e=document.createElement("div");return e.id="jsdos",e.classList.add("jsdos"),e.outerHTML}launchPacman(){const e=document.createElement("div");return e.id="jsdospac",e.classList.add("jsdos"),e.outerHTML}launchSnake(){const e=document.createElement("canvas");return e.id="snake",e.classList.add("snake"),e.outerHTML}launchSnakeOnWindowOpen(){const e=document.querySelector(".windows_area");new MutationObserver(s=>{for(let i of s)if(i.type==="childList")for(let n of i.addedNodes)n.nodeType===Node.ELEMENT_NODE&&n.classList.contains("window")&&n.dataset.name==="Snake"&&this.initializeSnakeGame(n),n.nodeType===Node.ELEMENT_NODE&&n.classList.contains("window")&&n.dataset.name==="Doom"&&this.initializeDoomGame(n),n.nodeType===Node.ELEMENT_NODE&&n.classList.contains("window")&&n.dataset.name==="Pacman"&&this.initializePacmanGame(n)}).observe(e,{childList:!0})}initializeDoomGame(e){const t=e.querySelector("#jsdos");t&&(t.id=`doom-${this.doomGameCounter++}`,t.width=e.offsetWidth,t.height=e.offsetHeight-e.querySelector(".controller").offsetHeight,new k(t.id,this.windows).launch())}initializePacmanGame(e){const t=e.querySelector("#jsdospac");t&&(t.id=`pacman-${this.pacmanGameCounter++}`,t.width=e.offsetWidth,t.height=e.offsetHeight-e.querySelector(".controller").offsetHeight,new F(t.id,this.windows).launch())}initializeSnakeGame(e){const t=e.querySelector("#snake");if(t&&(t.id=`snake-${this.snakeGameCounter++}`,t.width=e.offsetWidth,t.height=e.offsetHeight-e.querySelector(".controller").offsetHeight,t.getContext)){const s=new q(t.id,this.windows);s.init(),t.snakeGame=s}}createContextMenu(e,t){e.preventDefault(),this.removeExistingContextMenu();const s=this.createContextMenuElement(e);return t.dataset.name==="Poubelle"?this.addTrashOptions(s):this.addDefaultOptions(s),document.body.appendChild(s),this.addRemoveContextMenuEvent(s),s}removeExistingContextMenu(){const e=document.querySelector(".context-menu");e&&e.remove()}createContextMenuElement(e){const t=document.createElement("div");return t.style.position="absolute",t.style.left=`${e.pageX}px`,t.style.top=`${e.pageY}px`,t.classList.add("context-menu"),t}addTrashOptions(e){e.innerHTML='<button class="empty-trash">Vider la corbeille</button>',e.querySelector(".empty-trash").addEventListener("click",()=>{this.hierarchy.emptyBin(),e.remove()})}addDefaultOptions(e){e.innerHTML='<button class="delete">Supprimer</button><button class="restore">Restaurer</button>'}addRemoveContextMenuEvent(e){document.addEventListener("mousedown",function t(s){s.target.closest(".context-menu")||(e.remove(),document.removeEventListener("mousedown",t))})}setFolderPosition(e){let t=this.findFreePosition();for(;t&&this.grid[t[0]][t[1]]!==0;)t=this.findFreePosition();if(t){const[s,i]=t;this.grid[s][i]=e.dataset.name;const n=i*(this.gridSize+this.gap)+document.querySelector(".navigation").offsetHeight,o=s*(this.gridSize+this.gap),a=this.windowsArea.getBoundingClientRect(),r=Math.min(o,a.width-this.gridSize),c=Math.min(n,a.height-this.gridSize);e.style.position="absolute",e.style.left=`${r}px`,e.style.top=`${c}px`}else console.error("Aucune position de disponible sur le bureau.")}getFolderPosition(e){const t=e.dataset.name;for(let s=0;s<this.grid.length;s++)for(let i=0;i<this.grid[s].length;i++)if(this.grid[s][i]===t)return[s,i];return null}findFreePosition(){const e=document.querySelector(".dock").offsetHeight,t=window.innerHeight-e,s=this.lastFreePosition?this.lastFreePosition[0]:0,i=this.lastFreePosition?this.lastFreePosition[1]:0;for(let a=s;a<this.grid.length;a++)for(let r=i;r<this.grid[a].length;r++){const c=r*(this.gridSize+this.gap)+document.querySelector(".navigation").offsetHeight;if(this.grid[a][r]===0&&c<t)return[a,r]}return this.grid.length*(this.gridSize+this.gap)+document.querySelector(".navigation").offsetHeight<t?(this.grid.push(Array(this.gridSize).fill(0)),[this.grid.length-1,0]):(console.error("Aucune position de disponible sur le bureau."),null)}setFolderToFreePosition(e,t){let s=this.findFreePosition();if(s){const[i,n]=s;this.grid[i][n]=e.dataset.name;const o=n*(this.gridSize+this.gap)+document.querySelector(".navigation").offsetHeight,a=i*(this.gridSize+this.gap),r=Math.min(Math.max(a,0),t.width-this.gridSize),c=Math.min(Math.max(o,0),t.height-this.gridSize);e.style.left=`${r}px`,e.style.top=`${c}px`,this.lastFreePosition=s}}addDragEvents(e,t){e.draggable=!0,!e.closest(".window")&&(this.preventPropagationOnMouseDown(e),this.handleDragStart(e,t),this.handleDragOver(e),this.handleDragLeave(e),this.handleDrop(e,t),this.handleDragEnd(e))}preventPropagationOnMouseDown(e){e.querySelector("img").addEventListener("mousedown",s=>{s.stopPropagation()})}handleDragStart(e,t){e.addEventListener("dragstart",s=>{s.dataTransfer.setData("text/plain",t),this.draggedFolderName=t,e.classList.add("dragging"),this.draggedFolder=e,e.classList.contains("selected")||(this.selectedFolders.forEach(i=>{i.classList.remove("selected")}),this.selectedFolders=[]),this.previewElement=e.cloneNode(!0),this.previewElement.classList.add("folder-preview"),this.previewElement.style.position="absolute",document.querySelector(".windows_area").appendChild(this.previewElement)})}handleDragOver(e){e.addEventListener("dragover",t=>{t.preventDefault(),(e.dataset.type==="folder"||e.dataset.type==="game")&&e.classList.add("over")})}handleDragLeave(e){e.addEventListener("dragleave",()=>{e.classList.remove("over")})}handleDrop(e,t){e.addEventListener("drop",s=>{s.preventDefault();const i=s.dataTransfer.getData("text/plain"),n=document.querySelector(`.desktop-folder[data-name="${i}"]`);if(t===i){e.classList.remove("over");return}(e.dataset.type==="folder"||e.dataset.type==="game")&&(n.dataset.type!=="system"||i==="Snake")&&(e.childrenFolders[i]=n,n.style.display="none"),e.classList.remove("over")})}handleDragEnd(e){e.addEventListener("dragend",()=>{e.classList.remove("dragging"),this.updateGrid(e),this.previewElement&&(this.previewElement.remove(),this.previewElement=null)})}setupDragAndDrop(){this.setupDragOver(),this.setupDrop()}setupDragOver(){const e=document.querySelector(".windows_area");e.addEventListener("dragover",t=>{t.preventDefault();const s=this.draggedFolderName,i=document.querySelector(`.desktop-folder[data-name="${s}"]`);if(!i||i.closest(".window"))return;this.previewElement||(this.previewElement=i.cloneNode(!0),this.previewElement.classList.add("folder-preview"),this.previewElement.style.position="absolute",e.appendChild(this.previewElement));let n=Math.floor(t.clientX/(this.gridSize+this.gap))*(this.gridSize+this.gap),o=Math.floor(t.clientY/(this.gridSize+this.gap))*(this.gridSize+this.gap);const a=e.getBoundingClientRect();if(n=Math.min(Math.max(n,0),a.width-this.gridSize),o=Math.min(Math.max(o,0),a.height-this.gridSize),o+=document.querySelector(".navigation").offsetHeight,this.selectedFolders.length>1){const r=n-parseInt(this.draggedFolder.style.left),c=o-parseInt(this.draggedFolder.style.top);this.selectedFolders.forEach(d=>{d.style.left=`${parseInt(d.style.left)+r}px`,d.style.top=`${parseInt(d.style.top)+c}px`})}else i.style.left=`${n}px`,i.style.top=`${o}px`;this.previewElement.style.left=`${n}px`,this.previewElement.style.top=`${o}px`})}setupDrop(){const e=document.querySelector(".windows_area");e.addEventListener("drop",t=>{t.preventDefault();const s=this.draggedFolderName;document.querySelector(`.desktop-folder[data-name="${s}"]`)&&(this.selectedFolders.forEach(n=>{const o=n.getBoundingClientRect(),a=e.getBoundingClientRect();if(o.left<a.left||o.right>a.right||o.top<a.top||o.bottom>a.bottom)this.setFolderToFreePosition(n,a);else{const r=Math.floor(o.left/(this.gridSize+this.gap)),c=Math.floor((o.top-document.querySelector(".navigation").offsetHeight)/(this.gridSize+this.gap));this.grid[r][c]!==0&&this.setFolderToFreePosition(n,a)}this.updateGrid(n)}),this.draggedFolderName=null,this.previewElement&&(this.previewElement.remove(),this.previewElement=null),this.draggedFolder=null)})}startSelection(e){if(e.target.closest(".desktop-folder")||e.button!==0)return;const t=document.querySelector(".navigation").offsetHeight,s=document.querySelector(".dock").offsetHeight,i=window.innerHeight-s;if(e.clientY<t||e.clientY>i)return;const n=document.elementFromPoint(e.clientX,e.clientY);if(n.closest(".window")||n.closest(".window-menu"))return;this.isSelecting=!0,this.startX=e.clientX,this.startY=e.clientY,this.selectionBox=document.createElement("div"),this.selectionBox.style.position="absolute",this.selectionBox.style.left=`${this.startX}px`,this.selectionBox.style.top=`${this.startY}px`,this.selectionBox.style.border="1px solid rgba(12, 36, 97,1.0)",this.selectionBox.style.background="rgba(74, 105, 189,0.3)",this.selectionBox.style.pointerEvents="none",document.querySelectorAll(".window").forEach(a=>a.classList.add("no-select")),document.addEventListener("mousemove",this.updateSelection.bind(this)),document.addEventListener("mouseup",this.endSelection.bind(this)),document.body.appendChild(this.selectionBox)}updateSelection(e){if(!this.isSelecting)return;const t=document.querySelector(".dock").offsetHeight,s=window.innerHeight-t,i=Math.min(Math.max(e.clientY,this.navigation.offsetHeight),s),n=e.clientX,o=Math.abs(n-this.startX),a=Math.abs(i-this.startY),r=Math.min(n,this.startX),c=Math.min(i,this.startY);this.selectionBox.style.width=`${o}px`,this.selectionBox.style.height=`${a}px`,this.selectionBox.style.left=`${r}px`,this.selectionBox.style.top=`${c}px`,document.querySelectorAll(".desktop-folder").forEach(h=>{const p=h.getBoundingClientRect();!(p.right<this.selectionBox.offsetLeft||p.left>this.selectionBox.offsetLeft+this.selectionBox.offsetWidth||p.bottom<this.selectionBox.offsetTop||p.top>this.selectionBox.offsetTop+this.selectionBox.offsetHeight)?this.selectedFolders.includes(h)||(h.classList.add("selected"),this.selectedFolders.push(h),this.originalPositions[h.dataset.name]={left:h.style.left,top:h.style.top}):(h.classList.remove("selected"),this.selectedFolders=this.selectedFolders.filter(C=>C!==h),delete this.originalPositions[h.dataset.name])})}removeSelection(e){e.target.closest(".desktop-folder")||(this.selectedFolders.forEach(t=>{t.classList.remove("selected")}),this.selectedFolders=[])}endSelection(){if(!this.isSelecting)return;document.removeEventListener("mousemove",this.updateSelection.bind(this)),document.removeEventListener("mouseup",this.endSelection.bind(this)),document.querySelectorAll(".window").forEach(t=>t.classList.remove("no-select")),this.isSelecting=!1,document.body.removeChild(this.selectionBox),this.selectionBox=null}}const O=new w,f=new x(O);new k;const B=[{title:"Paramètres",path:S,icon:"./images/parameters.png",type:"system",showInDock:!0},{title:"Snake",path:f.launchSnake,icon:"./images/snake.png",type:"game",showInDock:!0},{title:"Doom",path:f.launchDoom,icon:"./images/doom.png",type:"game",showInDock:!0},{title:"Pacman",path:f.launchPacman,icon:"./images/pacman.png",type:"game",showInDock:!0},{title:"Corbeille",path:"",icon:"./images/bin.png",type:"system",showInDock:!0}];class z{constructor(e,t,s){this.shortcut=e,this.content=t,this.windows=s}createDockElement(){if(this.shortcut.showInDock){const e=document.querySelector(".dock_content"),t=document.createElement("div"),s=document.createElement("img");s.className="items_dock",s.src=this.shortcut.icon,s.alt=`Image de ${this.shortcut.title}`,t.appendChild(s),e.appendChild(t),t.addEventListener("click",()=>{this.windows.createNewWindow("center",this.shortcut.icon,this.shortcut.title,this.content,!0)})}}}class W{constructor(){this.windows=new w,this.desktop=new x(this.windows),this.turnOffButton=document.getElementById("turnOffButton"),this.startScreen=document.querySelector(".start"),this.container=document.querySelector(".container"),this.loadingScreen=document.querySelector(".loading-screen"),this.loadingText=document.getElementById("loading-text"),this.setupHoverEffect(),this.init()}init(){this.setupGlitchEffect(),this.setupMessageListener(),this.setupTurnOffButton(),this.initializeShortcuts()}setupGlitchEffect(){setInterval(()=>{const t=document.createElement("div");t.className="crt-glitch",document.body.appendChild(t),setTimeout(()=>{t.remove()},8e3)},Math.random()*6e3+1e4)}setupMessageListener(){window.addEventListener("message",e=>{e.data==="startPlaneClicked"?this.startComputer():e.data==="stopPlaneClicked"&&this.setupOffComputer()},!1),document.querySelector("#start").addEventListener("click",()=>{this.startComputer()}),setTimeout(()=>{this.startComputer(),window.parent.postMessage("startPlaneClicked","*")},3e4)}startComputer(){this.startScreen.style.display="none",this.showLoadingScreen()}showLoadingScreen(){const e=["Initialisation du système...","Chargement des modules de base...","Vérification de la mémoire...","Connexion au réseau local...","Téléchargement des dépendances...","Téléchargement : [          ]","Téléchargement : [*         ]","Téléchargement : [**        ]","Téléchargement : [***       ]","Téléchargement : [****      ]","Téléchargement : [*****     ]","Téléchargement : [******    ]","Téléchargement : [*******   ]","Téléchargement : [********  ]","Téléchargement : [********* ]","Téléchargement : [**********]","Téléchargement terminé.","Configuration des paramètres du système...","Initialisation des pilotes...","Lancement des services de base...","Lancement des services réseau...","Vérification des mises à jour...","Installation des mises à jour...","Optimisation des performances...","Démarrage des interfaces utilisateur...","Chargement des préférences utilisateur...","Préparation de l'environnement de bureau...","Finalisation du démarrage..."];let t=0;const s=setInterval(()=>{t<e.length?(this.loadingText.textContent+=e[t]+`
`,t++):(clearInterval(s),setTimeout(()=>{this.loadingScreen.style.display="none",this.container.style.display="block",this.container.classList.add("fade-out"),this.removeFadeOutClassAfterDelay()},500))},200)}removeFadeOutClassAfterDelay(){setTimeout(()=>{this.container.classList.remove("fade-out")},500)}setupTurnOffButton(){this.turnOffButton.addEventListener("click",()=>{this.setupOffComputer(),this.notifyParent()})}setupOffComputer(){document.body.classList.add("turn-off-animation"),new Audio("./sounds/off.mp3").play().then(e=>e).catch(e=>e),setTimeout(()=>{document.querySelectorAll(".crt-glitch").forEach(e=>e.remove()),document.body.classList.remove("fade-out"),document.body.classList.remove("turn-off-animation"),this.startScreen.style.display="flex",this.resetLoadingScreen()},550)}notifyParent(){window.parent.postMessage("stopPlaneClicked","*")}resetLoadingScreen(){this.loadingText.textContent="",this.loadingScreen.style.display="block"}initializeShortcuts(){B.forEach(e=>{new z(e,e.path,this.windows).createDockElement(),this.desktop.createLN(e.title,e.path,e.icon,e.type)})}setupHoverEffect(){document.querySelectorAll(".menu-button").forEach(t=>{t.addEventListener("mouseenter",()=>{this.clearArrow(),t.textContent="-> "+t.textContent.trim(),t.classList.add("active")})})}clearArrow(){document.querySelectorAll(".menu-button").forEach(t=>{t.textContent.startsWith("-> ")&&(t.textContent=t.textContent.substring(3),t.classList.remove("active"))})}}new W;
//# sourceMappingURL=index-DeV6NEz6.js.map
